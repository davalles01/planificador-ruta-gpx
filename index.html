<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Planificador de Ruta GPX</title>
  <link rel="stylesheet" href="style.css">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Leaflet.Elevation -->
  <link rel="stylesheet" href="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.css" />
  <script src="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.min.js"></script>
</head>
<body>
  <div id="theme-toggle" class="theme-container">
    <button id="lightModeBtn" class="active" title="Modo dÃ­a">â˜€ï¸</button>
    <button id="darkModeBtn" title="Modo noche">ğŸŒ™</button>
  </div>
  <h1>ğŸ—ºï¸ Planificador de Ruta GPX</h1>
  <!-- Subida / arrastre -->
  <section id="upload-section">
    <input type="file" id="gpxFileInput" accept=".gpx,.xml">
    <div id="dropZone" onclick="document.getElementById('gpxFileInput').click()">
      <span class="upload-icon">ğŸ“</span>
      <span class="upload-text">Haz clic aquÃ­ o arrastra tu archivo GPX</span>
    </div>
  </section>

  <!-- Datos grupo -->
  <section id="group-section">
    <label>
      NÃºmero de personas:
      <input type="number" id="numPersonas" min="1" placeholder="Introduce nÃºmero">
    </label>
    <label>
      Nivel tÃ©cnico del grupo:
      <select id="nivelTecnico">
        <option value="">Selecciona nivel</option>
        <option value="principiante">Principiantes</option>
        <option value="intermedio">Intermedio</option>
        <option value="alto">Alto</option>
      </select>
    </label>
    <button id="generarTablaBtn">Generar tabla</button>
  </section>

  <!-- Contenedor principal: controles a la izquierda, mapa a la derecha -->
  <div id="main-container">
    <div id="controls-panel">
      <!-- Controles de ediciÃ³n de waypoints -->
      <section id="waypoint-controls">
        <h2>Editar waypoints</h2>
        <button id="selectWaypointBtn">ğŸŸ¡ Seleccionar waypoint</button>
        <button id="addWaypointBtn">â• AÃ±adir waypoint</button>
        <button id="removeWaypointBtn">ğŸ—‘ï¸ Eliminar waypoint</button>
      </section>

      <!-- Panel de ediciÃ³n de waypoint -->
      <section id="waypoint-editor" style="display: none;">
        <h3>âœï¸ Editar waypoint</h3>
        <form id="waypointForm">
          <label>
            Latitud:
            <span id="wptLat"></span>
          </label>
          <label>
            Longitud:
            <span id="wptLon"></span>
          </label>
          <label>
            ElevaciÃ³n:
            <span id="wptEle"></span>
          </label>
          <label>
            Nombre:
            <input type="text" id="wptName">
          </label>
          <label>
            DescripciÃ³n:
            <textarea id="wptDesc"></textarea>
          </label>
          <div>
            <button type="submit">Guardar</button>
            <button type="button" id="cancelEdit">Cancelar</button>
          </div>
        </form>
      </section>

      <!-- Info ruta -->
      <section id="track-info">
        <h2>CaracterÃ­sticas de la ruta</h2>
        <ul>
          <li class="track-name-container">
            Nombre: 
            <input type="text" id="trackName" placeholder="Nombre de la ruta">
          </li>
          <li>Distancia: <span id="distancia"></span> km</li>
          <li>Desnivel positivo: <span id="desnivelPos"></span> m</li>
          <li>Desnivel negativo: <span id="desnivelNeg"></span> m</li>
          <li>DuraciÃ³n estimada: <span id="duracion"></span></li>
        </ul>
      </section>

      <button id="downloadGPXBtn">ğŸ’¾ Descargar GPX modificado</button>
    </div>

    <!-- Columna del mapa -->
    <div id="map-column">
      <section id="map-controls">
        <!-- Botones de ediciÃ³n de waypoints -->
        <div id="waypoint-undo-redo">
          <button id="undoWaypointBtn" title="Deshacer Ãºltimo cambio de waypoint">
            <span class="icon">â†¶</span> Deshacer
          </button>
          <button id="redoWaypointBtn" title="Rehacer cambio de waypoint">
            <span class="icon">â†·</span> Rehacer
          </button>
        </div>
        <div id="map-buttons"> 
          <button id="btnMapaEstandar">ğŸ—ºï¸ Mapa estÃ¡ndar</button>
          <button id="btnMapaSatelite">ğŸ›°ï¸ Mapa satÃ©lite</button>
          <button id="btnCurvasNivel">ğŸ”ï¸ Curvas de nivel</button>
        </div>
      </section>

      <div id="map"></div>
      <div id="elevation-div"></div>
    </div>
  </div>

  <script src="script.js"></script>
  <!-- Para exportaciÃ³n a Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>

  <!-- Para exportaciÃ³n a PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js"></script>
  <div id="tables-container" style="display: block;"></div>
</body>
</html>
